---
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogPost from "../components/BlogPost.astro";
import { splitRecentBlogPosts } from "../lib/blog";
import { shiftHeadingLevels } from "../lib/markdown";

const pageTitle = "The Little Room";
const { recent: recentPosts, older: olderPosts } = await splitRecentBlogPosts(5);

const recentPostsWithHtml = recentPosts.map((post: any) => ({
  post,
  html: post.rendered?.html ? shiftHeadingLevels(post.rendered.html, 1) : "",
}));
---

<BaseLayout pageTitle={pageTitle} pageTitleLevel={1}>
  <blockquote>
    <em>
      Well, you're in your little room, and you're working on something good<br>
      But if it's really good, you're gonna need a bigger room<br>
      And when you're in the bigger room, you might not know what to do<br>
      You might have to think of how you got started sitting in your little room
    </em>
    <p>- "Little Room" by the White Stripes</p>
  </blockquote>
  <p>This is a place where I'll post writing of my own. Mostly essays,short notes and my weekly retros.
    It's named after <a href="https://genius.com/The-white-stripes-little-room-lyrics">the White Stripes song</a> of the same name. I heard it years ago, and I've used the name for various incarnations of my blog ever since.
    To me it perfectly captures the essence of what I'm doing here: good work, in my little room, that'll maybe turn into something bigger. 
  </p>
  <div class="content">
    {recentPostsWithHtml.map(({ post, html }: any) => (
    <article>
      <h2>
        <a href={`/posts/${post.id}/`}>{post.data.title}</a>
        <p class="pub-date">
          {
            post.data.pubDate.toLocaleDateString("en-US", {
              month: "long",
              day: "numeric",
              year: "numeric",
            })
          }
        </p>
      </h2>
      {html && <div set:html={html} />}
    </article>
    ))}


  {olderPosts.length > 0 && (

      <h2>More Posts</h2>
      <ul>
        {olderPosts.map((post: any) => (
          <BlogPost
            url={`/posts/${post.id}/`}
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
          />
        ))}
      </ul>
  )}
  </div>
  <style>
    h2 {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }
    
    article {
      margin: 0 0 2rem 0;
      border-bottom: 2px var(--page-fg) dashed ;
    }

    .content {
      font-size: 1.25rem;
    }

    .pub-date {
      display: inline-flex;
      align-items: center;
      position: relative;
      top: -0.05em;
      margin: 0;
      padding: 0.15rem 0.65rem;
      border-radius: 999px;
      background-color: var(--aquamarine);
      font-family: var(--font-sans);
      font-size: 1rem;
      line-height: 1;
      white-space: nowrap;
    }

  </style>

</BaseLayout>
